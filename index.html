<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sakura-no-uta</title>

  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC",
                   "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
    }

    body {
      margin: 0;
      height: 100vh;
      overflow: hidden;
      color: #fff;
      background: #0b0b0f;
      position: relative;
    }

    /* 背景图层 */
    body::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image: url("assets/782B0DB04B0E4B3F910ADD20FB990F40.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;

      opacity: 0.14; /* 背景透明度：越大越明显 */
      filter: blur(6px);
      transform: scale(1.05);
      z-index: 0;
    }

    /* 主容器 */
    .app {
      position: relative;
      z-index: 1;
      display: flex;
      height: 100vh;
      width: 100%;
    }

    /* 左侧栏玻璃效果 */
    .sidebar {
      width: 280px;
      display: flex;
      flex-direction: column;
      padding: 16px;
      gap: 12px;

      background: rgba(0, 0, 0, 0.35);
      border-right: 1px solid rgba(255,255,255,0.12);
      backdrop-filter: blur(14px);
    }

    .title {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 1px;
      color: #ffb6c1;
      user-select: none;
      text-shadow: 0 0 10px rgba(255,182,193,0.35);
    }

    .controls {
      display: flex;
      gap: 8px;
    }

    button {
      border: none;
      cursor: pointer;
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 700;
      transition: 0.15s;
      font-size: 13px;
    }

    .btn-new {
      flex: 1;
      background: rgba(255, 182, 193, 0.85);
      color: #111;
    }

    .btn-new:hover {
      opacity: 0.85;
    }

    .btn-clear {
      background: rgba(255,255,255,0.10);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.15);
    }

    .btn-clear:hover {
      background: rgba(255,255,255,0.18);
    }

    .note-list {
      flex: 1;
      overflow-y: auto;
      padding-right: 6px;
    }

    .note-item {
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(255,255,255,0.06);
      margin-bottom: 8px;
      cursor: pointer;
      transition: 0.15s;
      border: 1px solid rgba(255,255,255,0.10);
      backdrop-filter: blur(10px);
    }

    .note-item:hover {
      background: rgba(255,255,255,0.10);
    }

    .note-item.active {
      background: rgba(255,182,193,0.22);
      border: 1px solid rgba(255,182,193,0.55);
    }

    .note-name {
      font-weight: 800;
      font-size: 13px;
      margin-bottom: 6px;
      color: #fff;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      text-shadow: 0 0 10px rgba(0,0,0,0.4);
    }

    .note-preview {
      font-size: 12px;
      opacity: 0.85;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      color: rgba(255,255,255,0.85);
    }

    /* 右侧编辑区玻璃效果 */
    .editor {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 18px;
      gap: 12px;

      background: rgba(0,0,0,0.25);
      backdrop-filter: blur(14px);
    }

    .topbar {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* 标题输入框（玻璃透明） */
    .note-title-input {
      flex: 1;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.08);
      color: #fff;
      font-size: 14px;
      font-weight: 800;
      outline: none;
      backdrop-filter: blur(10px);
    }

    .note-title-input::placeholder {
      color: rgba(255,255,255,0.55);
    }

    .note-title-input:focus {
      border-color: rgba(255,182,193,0.75);
      box-shadow: 0 0 0 3px rgba(255,182,193,0.12);
    }

    .btn-delete {
      background: rgba(255, 80, 80, 0.22);
      color: #fff;
      border: 1px solid rgba(255, 80, 80, 0.35);
      font-weight: 800;
    }

    .btn-delete:hover {
      background: rgba(255, 80, 80, 0.35);
    }

    /* 编辑文本框（玻璃透明） */
    textarea {
      flex: 1;
      resize: none;
      padding: 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.06);
      color: #fff;
      font-size: 14px;
      line-height: 1.7;
      outline: none;
      backdrop-filter: blur(12px);
      text-shadow: 0 0 12px rgba(0,0,0,0.35);
    }

    textarea::placeholder {
      color: rgba(255,255,255,0.55);
    }

    textarea:focus {
      border-color: rgba(255,182,193,0.75);
      box-shadow: 0 0 0 3px rgba(255,182,193,0.12);
    }

    /* 底部状态栏（透明） */
    .statusbar {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      user-select: none;

      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.10);
      backdrop-filter: blur(10px);

      color: rgba(255,255,255,0.8);
    }

    .empty {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0.75;
      font-size: 14px;

      border-radius: 16px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.10);
      backdrop-filter: blur(12px);
    }

    /* scrollbar */
    .note-list::-webkit-scrollbar {
      width: 6px;
    }

    .note-list::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.20);
      border-radius: 10px;
    }

    .note-list::-webkit-scrollbar-thumb:hover {
      background: rgba(255,255,255,0.35);
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="sidebar">
      <div class="title">Sakura-no-uta</div>

      <div class="controls">
        <button class="btn-new" id="newNoteBtn">+ 新建节点</button>
        <button class="btn-clear" id="exportBtn">导出</button>
      </div>

      <div class="note-list" id="noteList"></div>
    </div>

    <div class="editor" id="editorArea">
      <div class="empty">左侧新建一个节点开始记录。</div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "sakura_no_uta_notes_v1";

    let notes = [];
    let currentId = null;

    function saveNotes() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(notes));
    }

    function loadNotes() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        try {
          notes = JSON.parse(raw);
        } catch {
          notes = [];
        }
      } else {
        notes = [];
      }
    }

    function formatTime(ts) {
      const d = new Date(ts);
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      const hh = String(d.getHours()).padStart(2, "0");
      const mm = String(d.getMinutes()).padStart(2, "0");
      return `${y}-${m}-${day} ${hh}:${mm}`;
    }

    function getCurrentNote() {
      return notes.find(n => n.id === currentId);
    }

    function renderList() {
      const noteList = document.getElementById("noteList");
      noteList.innerHTML = "";

      notes.sort((a, b) => b.updatedAt - a.updatedAt);

      for (const note of notes) {
        const item = document.createElement("div");
        item.className = "note-item" + (note.id === currentId ? " active" : "");
        item.onclick = () => {
          currentId = note.id;
          renderList();
          renderEditor();
        };

        const name = document.createElement("div");
        name.className = "note-name";
        name.textContent = note.title || "未命名节点";

        const preview = document.createElement("div");
        preview.className = "note-preview";
        preview.textContent = (note.content || "").replace(/\n/g, " ").slice(0, 40) || "（空）";

        item.appendChild(name);
        item.appendChild(preview);

        noteList.appendChild(item);
      }
    }

    function renderEditor() {
      const editorArea = document.getElementById("editorArea");
      editorArea.innerHTML = "";

      const note = getCurrentNote();

      if (!note) {
        editorArea.innerHTML = `<div class="empty">左侧新建一个节点开始记录。</div>`;
        return;
      }

      const topbar = document.createElement("div");
      topbar.className = "topbar";

      const titleInput = document.createElement("input");
      titleInput.className = "note-title-input";
      titleInput.value = note.title;
      titleInput.placeholder = "节点标题（可改名）";

      titleInput.oninput = () => {
        note.title = titleInput.value;
        note.updatedAt = Date.now();
        saveNotes();
        renderList();
        updateStatus();
      };

      const deleteBtn = document.createElement("button");
      deleteBtn.className = "btn-delete";
      deleteBtn.textContent = "删除";
      deleteBtn.onclick = () => {
        if (!confirm("确定删除该节点？")) return;
        notes = notes.filter(n => n.id !== note.id);
        currentId = notes.length ? notes[0].id : null;
        saveNotes();
        renderList();
        renderEditor();
      };

      topbar.appendChild(titleInput);
      topbar.appendChild(deleteBtn);

      const textarea = document.createElement("textarea");
      textarea.value = note.content;
      textarea.placeholder = "在这里写下你的文字……";

      textarea.oninput = () => {
        note.content = textarea.value;
        note.updatedAt = Date.now();
        saveNotes();
        renderList();
        updateStatus();
      };

      const statusbar = document.createElement("div");
      statusbar.className = "statusbar";

      const left = document.createElement("span");
      const right = document.createElement("span");

      function updateStatus() {
        left.textContent = `最后保存：${formatTime(note.updatedAt)}`;
        right.textContent = `字数：${(note.content || "").length}`;
      }

      updateStatus();

      statusbar.appendChild(left);
      statusbar.appendChild(right);

      editorArea.appendChild(topbar);
      editorArea.appendChild(textarea);
      editorArea.appendChild(statusbar);
    }

    function newNote() {
      const id = crypto.randomUUID ? crypto.randomUUID() : String(Date.now());
      const now = Date.now();

      const note = {
        id,
        title: "新节点",
        content: "",
        createdAt: now,
        updatedAt: now
      };

      notes.unshift(note);
      currentId = id;
      saveNotes();
      renderList();
      renderEditor();
    }

    function exportNotes() {
      const data = {
        exportedAt: new Date().toISOString(),
        notes
      };

      const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = "Sakura-no-uta-notes.json";
      a.click();

      URL.revokeObjectURL(url);
    }

    document.getElementById("newNoteBtn").onclick = newNote;
    document.getElementById("exportBtn").onclick = exportNotes;

    loadNotes();
    currentId = notes.length ? notes[0].id : null;
    renderList();
    renderEditor();
  </script>
</body>
</html>
